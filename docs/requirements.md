# kusa-hayasu 要件定義書

## 1. プロダクト概要

**アプリ名**: kusa-hayasu（草生やす）

**コンセプト**: GitHub のコントリビューショングラフ（草）のように、習慣の達成状況を可視化するWebアプリケーション。

**設計思想**: 習慣の継続に対して脅迫的にならない。ユーザーの心理的安全を最優先にし、記録を取り消しても連続数はリセットしない。

**メイン利用端末**: スマホファースト（モバイル最優先）

## 2. フェーズ計画

### Phase 1（MVP）

- ローカル保存（localStorage）のみのWebアプリ
- 習慣の CRUD と日次記録
- 草グラフ表示（SVG自作）
- ダークモード
- お祝いアニメーション

### Phase 2（将来）

- Supabase 導入（アカウント作成・端末間同期）
- 曜日指定（月水金だけ等）
- 回数・時間の記録
- 習慣化のコツ・豆知識（ローディング中、カレンダー切替時に表示）
- Figma デザイン + MCP 導入

### Phase 3（将来）

- iOS ネイティブアプリ化（Capacitor or SwiftUI）
- プッシュ通知

## 3. 機能要件

### 3.1 習慣管理

| 機能 | Phase 1 | 詳細 |
|------|---------|------|
| 習慣の作成 | ✅ | 名前、色、アニメーションパターンを設定 |
| 習慣の編集 | ✅ | 名前、色、アニメーションパターンを変更可能 |
| 習慣のアーカイブ | ✅ | 非表示にするがデータは保持 |
| 習慣の完全削除 | ✅ | データごと削除（確認ダイアログあり） |
| 複数習慣の管理 | ✅ | 複数の草カレンダーを持てる |
| 習慣の頻度設定 | ❌ Phase 2 | 曜日指定（毎日がデフォルト） |

### 3.2 記録

| 機能 | Phase 1 | 詳細 |
|------|---------|------|
| 達成ボタン | ✅ | 1日1回の完了/未完了（トグル） |
| 過去日付への記録 | ✅ | さかのぼり記録が可能 |
| 記録の取り消し | ✅ | 取り消し可能。連続数はリセットしない |
| 回数・時間の記録 | ❌ Phase 2 | 将来拡張 |

### 3.3 草カレンダー（グラフ）

| 機能 | Phase 1 | 詳細 |
|------|---------|------|
| GitHub風の草グラフ | ✅ | SVG で自作。右端が今日、左端が過去 |
| 表示期間の切替 | ✅ | 1日, 7日, 14日, 31日, 3ヶ月, 6ヶ月, 1年 |
| カレンダーごとの色設定 | ✅ | テーマカラーをカスタマイズ |
| スワイプで切替 | ✅ | 横スワイプで他の習慣に切替、下スワイプでカレンダー表示 |
| ボタン/カレンダー切替 | ✅ | デフォルトはボタンビュー、下スワイプでカレンダービュー |
| アクティビティ一覧 | ✅ | 全カレンダーをリスト表示 |

### 3.4 お祝いアニメーション

| 機能 | Phase 1 | 詳細 |
|------|---------|------|
| マイルストーン達成時に再生 | ✅ | 達成時に自動再生 |
| 複数パターン | ✅ | お祭り、トースト、草グラフ演出 等 |
| カレンダーごとに選択 | ✅ | 習慣作成・編集時に選べる |
| 習慣化のコツ表示 | ✅ | マイルストーン達成時に豆知識を表示 |

**マイルストーンのタイミング:**

- 3日、7日、14日、30日（初期は密に）
- 以降は1ヶ月ごと（60日、90日、120日...）
- 365日達成でスーパーアニメーション（特別演出）

**注意**: 連続数は記録の取り消しでリセットしない（脅迫的にならない設計）。

### 3.5 UI/UX

| 機能 | Phase 1 | 詳細 |
|------|---------|------|
| スマホファースト | ✅ | モバイル最優先のレスポンシブデザイン |
| ダークモード | ✅ | next-themes で切替 |
| shadcn/ui | ✅ | リッチなUIコンポーネント |
| カレンダーごとのテーマ | ✅ | 習慣の色がUIのアクセントカラーに動的反映 |

### 3.6 デザイン強化（Phase 2以降）

| 機能 | Phase | 詳細 |
|------|-------|------|
| Figma でデザイン作成 | 2 | 動くものができた後にデザインを整える |
| Figma MCP 導入 | 2 | デザインからコードへの反映を自動化 |

### 3.7 将来機能（Phase 2以降）

| 機能 | Phase | 詳細 |
|------|-------|------|
| アカウント作成 | 2 | Supabase Auth |
| 端末間同期 | 2 | Supabase Realtime |
| 曜日指定 | 2 | 習慣ごとに実施曜日を設定 |
| 回数・時間記録 | 2 | 達成の粒度を細かく |
| ローディング中の豆知識 | 2 | カレンダー切替・ローディング時に表示 |
| iOS ネイティブ化 | 3 | Capacitor or SwiftUI |
| プッシュ通知 | 3 | リマインダー |
| Figma デザイン + MCP | 2 | デザインシステム構築・コード自動反映 |

## 4. 画面構成（Phase 1）

### メイン画面：ボタンビュー（デフォルト）

- 習慣名を上部に表示
- 達成ボタンを大きく中央に配置（片手で押しやすく）
- 連続日数を小さく表示
- **横スワイプ**: 他の習慣のボタンビューに切替
- **下スワイプ**: カレンダービューに遷移

### メイン画面：カレンダービュー

- 習慣名を上部に表示
- 草グラフ（SVG）を表示
- 表示期間の切替タブ（1日, 7日, 14日, 31日, 3ヶ月, 6ヶ月, 1年）
- 過去日付へのさかのぼり記録もこの画面から
- **上スワイプ**: ボタンビューに戻る

### アクティビティ一覧画面

- 全カレンダーをリスト形式で一覧表示
- 各カレンダーのミニグラフ + 連続数

### 習慣管理画面

- 習慣の作成・編集・アーカイブ・削除
- 色の選択
- アニメーションパターンの選択・プレビュー

### 設定画面

- ダークモード切替
- データのエクスポート（将来のバックアップ用）

## 5. 技術スタック

| 項目 | 技術 |
|------|------|
| フレームワーク | Next.js 15（App Router） |
| 言語 | TypeScript（strict） |
| UI | shadcn/ui + Tailwind CSS v4 |
| データ保存 | localStorage（Phase 1） |
| 日付操作 | date-fns |
| テーマ | next-themes |
| 草グラフ | SVG 自作 |
| パッケージマネージャー | pnpm |
| 開発ツール | Claude Code |

## 6. 非機能要件

- スマホファーストのレスポンシブデザイン
- localStorage のデータ消失リスクをユーザーに明示
- 達成ボタンは片手で押しやすいサイズ・位置
- アニメーションはパフォーマンスに配慮（CSS/SVGアニメーション推奨）
- hydration mismatch を防ぐ設計（localStorage はクライアント側でのみ読み込む）
